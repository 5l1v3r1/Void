#pragma once
#ifndef _V_WAVAUDIO_H_
#define _V_WAVAUDIO_H_

#include "../../AudioBase/VAudioBase.h"
#include <vector>

//----------------------------------------------------------------------------------------------------
namespace Void
{
    #pragma pack(push, 2)
    // VWAVAudioChunk
    //----------------------------------------------------------------------------------------------------
    struct VWAVAudioChunk
    {
        //----------------------------------------------------------------------------------------------------
        char fourCC[4];
        unsigned int size;
    };
    
    // VWAVAudioFormatData
    //----------------------------------------------------------------------------------------------------
    // 2 + 2 + 4 + 4 + 2 + 2 + (2) = 16 + (2)
    //----------------------------------------------------------------------------------------------------
    // FormatTag | 0x0001 | WAVE_FORMAT_PCM
    //           | 0x0002 | WAVE_FORMAT_ADPCM
    //           | 0x0003 | WAVE_FORMAT_IEEE_FLOAT
    //           |    ... |
    //----------------------------------------------------------------------------------------------------
    struct VWAVAudioFormatData
    {
        //----------------------------------------------------------------------------------------------------
        VWAVAudioFormatData()
            :
            extraSize(0)
        {
        }
        
        //----------------------------------------------------------------------------------------------------
        VWAVAudioFormatData(const VWAVAudioFormatData& _data)
            :
            formatTag(_data.formatTag),
            channels(_data.channels),
            samplesPerSec(_data.samplesPerSec),
            bytesPerSec(_data.bytesPerSec),
            blockAlign(_data.blockAlign),
            bitsPerSample(_data.bitsPerSample),
            extraSize(_data.extraSize)
        {
        }
        
        //----------------------------------------------------------------------------------------------------
        unsigned short formatTag;
        unsigned short channels;
        unsigned int samplesPerSec;
        unsigned int bytesPerSec;
        unsigned short blockAlign;
        unsigned short bitsPerSample;
        unsigned short extraSize;
    };
    #pragma pack(pop)
    
    // VWAVAudio
    //----------------------------------------------------------------------------------------------------
    // RIFF Chunk | FourCC (RIFF)
    //            |---------------------------------------------------------------------------------------
    //            | Size
    //            |---------------------------------------------------------------------------------------
    //            | FormType (WAVE)
    //            |---------------------------------------------------------------------------------------
    //            | Format Chunk | FourCC (fmt)
    //            |              |------------------------------------------------------------------------
    //            |              | Size
    //            |              |------------------------------------------------------------------------
    //            |              | FormatTag
    //            |              |------------------------------------------------------------------------
    //            |              | Channels
    //            |              |------------------------------------------------------------------------
    //            |              | SamplesPerSec
    //            |              |------------------------------------------------------------------------
    //            |              | BytesPerSec
    //            |              |------------------------------------------------------------------------
    //            |              | BlockAlign
    //            |              |------------------------------------------------------------------------
    //            |              | BitsPerSample
    //            |              |------------------------------------------------------------------------
    //            |              | ExtraSize
    //            |---------------------------------------------------------------------------------------
    //            | Fact Chunk | FourCC (fact)
    //            | (option)   |--------------------------------------------------------------------------
    //            |            | Size
    //            |            |--------------------------------------------------------------------------
    //            |            | SampleCount
    //            |---------------------------------------------------------------------------------------
    //            | Data Chunk | FourCC (data)
    //            |            |--------------------------------------------------------------------------
    //            |            | Size
    //            |            |--------------------------------------------------------------------------
    //            |            | Data
    //----------------------------------------------------------------------------------------------------
    class VWAVAudio : public VAudioBase
    {
    public:
        //----------------------------------------------------------------------------------------------------
        VWAVAudio();
        VWAVAudio(VAudioBase& _audio);
        VWAVAudio(VAudioBase&& _audio);
        VWAVAudio(const VWAVAudio& _audio);
        virtual ~VWAVAudio();
        
        //----------------------------------------------------------------------------------------------------
        bool ReadFromFile(const char* _fileName);
        bool WriteToFile(const char* _fileName);
        
    protected:
        //----------------------------------------------------------------------------------------------------
        bool IsFourCC(char _value[4], char _first, char _second, char _third, char _fourth);
        std::string BinaryString(int _value);
        void RefreshFormat();
        void RefreshWAVFormat();
        
    protected:
        //----------------------------------------------------------------------------------------------------
        VWAVAudioFormatData mWAVFormat;
    };
    
    // Test
    //----------------------------------------------------------------------------------------------------
    void VWAVAudioTest();
}

#endif
